<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MicFinder - Command Center</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Fonts -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Space+Mono:wght@400;700&family=Space+Grotesk:wght@500;600;700&display=swap');

        :root {
            --swiss-red: #ff3300;
            --deep-void: #09090b;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--deep-void);
            overflow: hidden;
        }
        .font-mono { font-family: 'Space Mono', monospace; }
        .font-display { font-family: 'Space Grotesk', sans-serif; }

        /* --- SWISS CARD STYLES --- */
        .swiss-card {
            background: rgba(0, 0, 0, 0.4);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
            overflow: hidden;
            /* Height management handled via padding in JS to ensure consistency */
        }

        /* Kinetic Hover: Slide & Invert */
        .swiss-card:hover {
            background: #ffffff;
            color: #000000;
            padding-left: 2rem !important; /* Kinetic Shift */
        }
        
        /* The sliding accent bar */
        .swiss-accent-bar {
            position: absolute;
            left: 0; top: 0; bottom: 0; width: 6px;
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 20;
        }
        .swiss-card:hover .swiss-accent-bar {
            transform: translateX(0);
        }

        /* Text Color Inversion on Hover */
        .swiss-card:hover h3, 
        .swiss-card:hover .time-display { color: #000000 !important; }
        .swiss-card:hover .sub-text { color: #52525b !important; }
        .swiss-card:hover .tag-border { border-color: #000000 !important; color: #000000 !important; }

        /* --- UI COMPONENTS --- */
        .glass-panel {
            background: rgba(18, 18, 21, 0.95);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.9);
        }

        /* Map Dark Mode */
        .leaflet-layer { 
            filter: grayscale(100%) invert(100%) contrast(2.5) brightness(0.6); 
        }
        .leaflet-container { background: #09090b; }

        /* Capsule Buttons */
        .capsule-btn { transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); }
        .capsule-btn.active { 
            background: var(--swiss-red); 
            color: white; 
            font-weight: 700;
        }
        .capsule-btn:not(.active) { color: #71717a; } 
        .capsule-btn:not(.active):hover { color: white; background: rgba(255,255,255,0.08); }

        /* Drawer Transition */
        #list-drawer { transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Pin Pulse */
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.5; }
            100% { transform: scale(2.5); opacity: 0; }
        }
        .pin-pulse::before {
            content: '';
            position: absolute; top: 50%; left: 50%;
            width: 100%; height: 100%;
            transform: translate(-50%, -50%);
            background: var(--swiss-red);
            border-radius: 50%; z-index: -1;
            animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="h-screen w-screen relative selection:bg-[#ff3300] selection:text-white">

    <!-- 1. MAP LAYER -->
    <div id="map" class="absolute inset-0 z-0 bg-[#09090b]"></div>

    <!-- 2. COMMAND BAR -->
    <div class="absolute top-4 left-3 right-3 md:left-4 md:w-[380px] z-[1000] flex flex-col pointer-events-none">
        <div class="glass-panel h-[56px] rounded-full flex items-center p-1.5 pointer-events-auto relative z-20">
            <!-- Search -->
            <div class="flex-1 flex items-center h-full pl-4 pr-2 group cursor-text" onclick="document.getElementById('search-input').focus()">
                <svg class="w-4 h-4 text-neutral-500 group-focus-within:text-[#ff3300] transition-colors shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                <input type="text" id="search-input" placeholder="Search grid..." class="w-full bg-transparent border-none text-sm text-white placeholder-neutral-600 ml-2 font-medium h-full focus:outline-none focus:ring-0">
            </div>
            <!-- Toggle -->
            <div class="flex items-center bg-black/40 rounded-full p-1 border border-white/5 shrink-0">
                <button onclick="setMode('today')" id="btn-today" class="capsule-btn active px-3 py-1.5 rounded-full text-[10px] uppercase tracking-wider leading-none">Today</button>
                <button onclick="setMode('tomorrow')" id="btn-tomorrow" class="capsule-btn px-3 py-1.5 rounded-full text-[10px] uppercase tracking-wider leading-none">Tmrw</button>
            </div>
            <!-- Divider -->
            <div class="w-[1px] h-5 bg-white/10 mx-2"></div>
            <!-- Drawer Btn -->
            <button onclick="toggleDrawer()" id="drawer-btn" class="w-10 h-10 rounded-full hover:bg-white/10 flex items-center justify-center text-neutral-400 hover:text-white transition-all active:scale-90">
                <svg id="chevron-icon" class="w-5 h-5 transition-transform duration-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </button>
        </div>
    </div>

    <!-- 3. LIST DRAWER -->
    <div id="list-drawer" class="glass-panel rounded-3xl overflow-hidden flex flex-col pointer-events-auto 
        fixed bottom-4 left-3 right-3 z-[900] max-h-0 opacity-0
        md:absolute md:top-[76px] md:left-4 md:right-auto md:w-[380px] md:bottom-auto md:z-[1000]">
        
        <!-- HEADER -->
        <div class="px-6 py-5 border-b border-white/10 flex justify-between items-end bg-[#050505]/95 backdrop-blur-md shrink-0 sticky top-0 z-30">
            <div>
                <span class="text-[9px] font-mono text-[#ff3300] uppercase tracking-widest mb-1 block">System 01</span>
                <h2 class="text-2xl font-bold tracking-tighter leading-none text-white font-display">LIVE FEED</h2>
            </div>
            <div class="text-right">
                <div id="status-dot" class="w-2 h-2 rounded-full bg-[#ff3300] animate-pulse inline-block mb-1"></div>
                <span class="text-[10px] font-mono text-neutral-500 block" id="results-count">Scanning...</span>
            </div>
        </div>

        <!-- CONTENT LIST -->
        <div id="list-content" class="overflow-y-auto no-scrollbar max-h-[50vh] md:max-h-[80vh] scroll-smooth bg-transparent">
            <!-- CARDS INJECTED HERE -->
        </div>
    </div>

    <script>
        // --------------------------------------------------------
        // 1. DATA GENERATION
        // --------------------------------------------------------
        const venues = ["Village Underground", "Comedy Cellar", "The Stand", "Grisly Pear", "Tiny Cupboard", "QED Astoria", "Grove 34", "Eastville", "West Side Comedy", "Gotham Club"];
        const hoods = ["Greenwich Vlg", "MacDougal St", "Union Square", "Bushwick", "Astoria", "Midtown", "Chelsea", "LES"];
        const mics = [];
        const now = new Date();

        function addDays(date, days) { const r = new Date(date); r.setDate(r.getDate() + days); return r; }

        for (let i = 0; i < 7; i++) {
            const dayBase = addDays(now, i);
            const numMics = 5 + Math.floor(Math.random() * 5); 
            
            for(let j=0; j<numMics; j++) {
                const hour = 17 + Math.floor(Math.random() * 9); 
                const micDate = new Date(dayBase);
                micDate.setHours(hour, (Math.random() > 0.5 ? 0 : 30), 0, 0);

                if (micDate < now) { micDate.setDate(micDate.getDate() + 7); }

                const diffMins = (micDate - now) / 60000;
                const isUrgent = diffMins > -15 && diffMins <= 90 && i === 0;

                mics.push({
                    id: `${i}-${j}`,
                    title: venues[Math.floor(Math.random() * venues.length)],
                    start: micDate,
                    timeStr: micDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12: false}), 
                    lat: 40.73 + (Math.random() * 0.08 - 0.04),
                    lng: -73.99 + (Math.random() * 0.08 - 0.04),
                    price: Math.random() > 0.6 ? "$5" : "Free",
                    hood: hoods[Math.floor(Math.random() * hoods.length)],
                    isUrgent: isUrgent,
                    type: Math.random() > 0.5 ? "Bucket" : "Lottery"
                });
            }
        }
        mics.sort((a,b) => a.start - b.start);

        // --------------------------------------------------------
        // 2. MAP SETUP
        // --------------------------------------------------------
        const map = L.map('map', { zoomControl: false, attributionControl: false }).setView([40.735, -73.99], 13);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', { maxZoom: 19 }).addTo(map);
        const markersGroup = L.layerGroup().addTo(map);

        const createPin = (urgent) => {
            const color = urgent ? '#ff3300' : '#ffffff';
            return L.divIcon({
                className: 'bg-transparent',
                html: `<div class="relative flex items-center justify-center w-6 h-6 ${urgent ? 'pin-pulse' : ''}">
                        <div class="relative w-3 h-3 bg-[${color}] border border-black shadow-xl transform rotate-45"></div>
                       </div>`
            });
        };

        // --------------------------------------------------------
        // 3. UI RENDERING (CLEAN SWISS STYLE)
        // --------------------------------------------------------
        let currentMode = 'today';
        let isDrawerOpen = false;

        function render(mode) {
            const container = document.getElementById('list-content');
            const countLabel = document.getElementById('results-count');
            const searchVal = document.getElementById('search-input').value.toLowerCase();
            
            markersGroup.clearLayers();
            container.innerHTML = '';

            let filtered = mics.filter(m => {
                const micDateStr = m.start.toDateString();
                const todayStr = now.toDateString();
                const tmrwStr = addDays(now, 1).toDateString();
                
                if (mode === 'today' && micDateStr !== todayStr) return false;
                if (mode === 'tomorrow' && micDateStr !== tmrwStr) return false;
                if (searchVal && !m.title.toLowerCase().includes(searchVal) && !m.hood.toLowerCase().includes(searchVal)) return false;
                return true;
            });

            countLabel.innerText = `${filtered.length} ACTIVE SIGNALS`;
            
            // Render Markers
            filtered.forEach(mic => {
                L.marker([mic.lat, mic.lng], { 
                    icon: createPin(mic.isUrgent), 
                    zIndexOffset: mic.isUrgent ? 1000 : 100 
                }).addTo(markersGroup).on('click', () => {
                    if(!isDrawerOpen) toggleDrawer(true);
                    document.getElementById(`card-${mic.id}`)?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                });
            });

            if(filtered.length === 0) {
                container.innerHTML = `<div class="text-center py-12 text-neutral-600 text-[10px] font-mono uppercase tracking-widest">Signal Lost / No Mics</div>`;
                return;
            }

            // Render Clean Cards
            filtered.forEach(mic => {
                const accentColor = mic.isUrgent ? '#ff3300' : '#ffffff';
                const timeColor = mic.isUrgent ? 'text-[#ff3300]' : 'text-neutral-500';
                
                const card = document.createElement('div');
                card.id = `card-${mic.id}`;
                card.onclick = () => locateMic(mic.lat, mic.lng, mic.id);
                
                // Increased Padding (py-6) to replace the lost height from the sparkline
                // ensuring the card size remains generous and consistent.
                card.className = `swiss-card group cursor-pointer px-6 py-6 border-b border-white/5`; 
                
                card.innerHTML = `
                    <!-- The Sliding Bar -->
                    <div class="swiss-accent-bar" style="background-color: ${accentColor}"></div>

                    <!-- Top Row: Meta -->
                    <div class="flex justify-between items-start mb-2 relative z-10">
                        <div class="flex gap-2">
                            <span class="tag-border px-1.5 py-0.5 border border-white/20 text-neutral-400 text-[10px] font-bold uppercase tracking-wider group-hover:border-black group-hover:text-black transition-colors">${mic.type}</span>
                            <span class="text-[10px] font-bold uppercase text-neutral-500 self-center">${mic.price}</span>
                        </div>
                        <span class="text-[10px] font-mono text-neutral-600 uppercase tracking-widest group-hover:text-black">${mic.hood}</span>
                    </div>

                    <!-- Bottom Row: Title & Time -->
                    <div class="flex justify-between items-center relative z-10">
                        <div class="pr-4">
                            <h3 class="text-xl font-bold leading-none tracking-tight text-white mb-1 transition-colors font-display">${mic.title}</h3>
                            <p class="sub-text text-neutral-500 text-xs font-mono transition-colors">Sign-up 30m Prior</p>
                        </div>
                        
                        <div class="text-right shrink-0">
                            <span class="time-display text-4xl font-bold tracking-tighter block leading-none ${timeColor} transition-colors">${mic.timeStr}</span>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // --------------------------------------------------------
        // 4. INTERACTIONS
        // --------------------------------------------------------
        function setMode(mode) {
            document.querySelectorAll('.capsule-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${mode}`).classList.add('active');
            currentMode = mode;
            render(mode);
        }

        function toggleDrawer(forceOpen) {
            const drawer = document.getElementById('list-drawer');
            const icon = document.getElementById('chevron-icon');
            const btn = document.getElementById('drawer-btn');
            
            isDrawerOpen = forceOpen !== undefined ? forceOpen : !isDrawerOpen;
            const isDesktop = window.matchMedia('(min-width: 768px)').matches;
            
            if(isDrawerOpen) {
                drawer.style.maxHeight = isDesktop ? '85vh' : '55vh';
                drawer.style.opacity = '1';
                icon.style.transform = 'rotate(180deg)';
                btn.classList.add('bg-white/10', 'text-white');
            } else {
                drawer.style.maxHeight = '0';
                drawer.style.opacity = '0';
                icon.style.transform = 'rotate(0deg)';
                btn.classList.remove('bg-white/10', 'text-white');
            }
        }

        function locateMic(lat, lng, id) {
            map.flyTo([lat, lng], 15, { duration: 1.2, easeLinearity: 0.25 });
        }

        document.getElementById('search-input').addEventListener('keyup', () => {
            if(!isDrawerOpen) toggleDrawer(true);
            render(currentMode);
        });

        // Initialize
        render('today');
        setTimeout(() => toggleDrawer(true), 500);
    </script>
</body>
</html>