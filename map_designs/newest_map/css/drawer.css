/* =================================================================
   DRAWER STYLES
   Glass panel, drawer transitions, states
   ================================================================= */

/* --- GLASS PANEL --- */
.glass-panel {
    background: #000;
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-top: 2px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 -4px 30px rgba(0, 0, 0, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

/* Drawer Transition - iOS spring curve, GPU accelerated */
#list-drawer {
    transition: transform 0.3s cubic-bezier(0.32, 0.72, 0, 1),
                height 0.3s cubic-bezier(0.32, 0.72, 0, 1),
                opacity 0.25s ease-out;
    will-change: transform, height, opacity;
}

/* Desktop drawer states - fully hide/show via search bar toggle */
@media (min-width: 768px) {
    #list-drawer {
        height: auto;
        max-height: calc(100vh - 100px);
    }
    /* Closed: fully hidden */
    #list-drawer.drawer-peek,
    #list-drawer.drawer-closed {
        opacity: 0;
        transform: translateY(-20px);
        pointer-events: none;
    }
    /* Open: fully visible */
    #list-drawer.drawer-open {
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto;
    }
}

/* Mobile drawer states - 2 snap points: peek (1 card visible) and open */
@media (max-width: 767px) {
    #list-drawer {
        height: calc(68 * var(--vh)) !important;
        max-height: none !important;
        /* Position at bottom of screen */
        position: fixed !important;
        bottom: 0 !important;
        left: 0 !important;
        right: 0 !important;
        top: auto !important;
        border-radius: 24px 24px 0 0 !important;
        transition: transform 0.3s cubic-bezier(0.32, 0.72, 0, 1);
    }
    /* Peek state: shows header + peek at first card (~120px visible) */
    #list-drawer.drawer-peek {
        transform: translateY(calc(100% - 120px)) !important;
        pointer-events: auto !important;
    }
    /* Hide time headers in peek mode so mic cards are visible */
    #list-drawer.drawer-peek #list-content > .time-header {
        display: none;
    }
    /* Tighten spacing in peek mode for better card visibility */
    #list-drawer.drawer-peek .mics-header-row {
        padding: 8px 16px;
    }
    #list-drawer.drawer-peek #list-content {
        padding-top: 0;
    }
    #list-drawer.drawer-peek #list-content > .stream-item:first-of-type {
        padding-top: 8px;
    }
    /* Hide safe area padding in peek mode */
    #list-drawer.drawer-peek {
        padding-bottom: 0 !important;
    }
    /* Open state: full drawer */
    #list-drawer.drawer-open {
        transform: translateY(0) !important;
        pointer-events: auto !important;
    }
}

/* Backdrop overlay when drawer is fully open */
#drawer-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s cubic-bezier(0.32, 0.72, 0, 1);
    z-index: 899;
}
#drawer-backdrop.active {
    opacity: 1;
    pointer-events: auto;
}

/* iOS rubber-banding fix + dynamic viewport height */
#list-content {
    overscroll-behavior: contain;
    max-height: calc(52 * var(--vh));
    overflow-x: hidden; /* Prevent horizontal scroll/drag */
}

/* Lock drawer to vertical only - no horizontal movement */
#list-drawer {
    overflow-x: hidden;
}
@media (min-width: 768px) {
    #list-content { max-height: calc(100vh - 180px); }
}

/* Safe area insets for iPhone X+ */
.glass-panel.rounded-full { padding-top: max(0.375rem, env(safe-area-inset-top)); }
#list-drawer { padding-bottom: env(safe-area-inset-bottom); }

/* --- DRAG HANDLE --- */
.drag-handle {
    /* 48px minimum touch target (WCAG AAA compliant) */
    min-width: 48px;
    min-height: 48px;
    /* Visual feedback on drag */
    transition: transform 0.1s ease-out;
}

.drag-handle:active {
    transform: translateX(-50%) scale(1.05);
}

.drag-handle span {
    transition: background-color 0.15s ease, transform 0.15s ease;
}

.drag-handle:active span {
    background-color: rgba(255, 255, 255, 0.7);
    transform: scaleX(1.1);
}
