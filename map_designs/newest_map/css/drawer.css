/* =================================================================
   DRAWER STYLES
   Glass panel, drawer transitions, states
   ================================================================= */

/* --- GLASS PANEL --- */
.glass-panel {
    background: #000;
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-top: 2px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 -4px 30px rgba(0, 0, 0, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

/* Drawer Transition - iOS spring curve, GPU accelerated */
#list-drawer {
    transition: transform 0.3s cubic-bezier(0.32, 0.72, 0, 1),
                height 0.3s cubic-bezier(0.32, 0.72, 0, 1),
                opacity 0.25s ease-out;
    will-change: transform, height, opacity;
}

/* Desktop drawer states - fully hide/show via search bar toggle */
@media (min-width: 768px) {
    #list-drawer {
        height: auto;
        max-height: calc(100vh - 100px);
    }
    /* Closed: fully hidden */
    #list-drawer.drawer-peek,
    #list-drawer.drawer-closed {
        opacity: 0;
        transform: translateY(-20px);
        pointer-events: none;
    }
    /* Open: fully visible */
    #list-drawer.drawer-open {
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto;
    }
}

/* Mobile drawer states - 2 snap points: peek (1 card visible) and open */
@media (max-width: 767px) {
    #list-drawer {
        height: calc(68 * var(--vh)) !important;
        max-height: none !important;
        overflow: hidden !important; /* Required for child scroll to work */
        /* Position at bottom of screen */
        position: fixed !important;
        bottom: 0 !important;
        left: 0 !important;
        right: 0 !important;
        top: auto !important;
        border-radius: 24px 24px 0 0 !important;
        transition: transform 0.3s cubic-bezier(0.32, 0.72, 0, 1);
    }
    /* Peek state: shows header + peek at first card (~120px visible) */
    #list-drawer.drawer-peek {
        transform: translateY(calc(100% - 120px)) !important;
        pointer-events: auto !important;
    }
    /* Hide time headers in peek mode so mic cards are visible */
    #list-drawer.drawer-peek #list-content > .time-header {
        display: none;
    }
    /* Tighten spacing in peek mode for better card visibility */
    #list-drawer.drawer-peek .mics-header-row {
        padding: 8px 16px;
    }
    #list-drawer.drawer-peek #list-content {
        padding-top: 0;
    }
    #list-drawer.drawer-peek #list-content > .stream-item:first-of-type {
        padding-top: 8px;
    }
    /* Hide safe area padding in peek mode */
    #list-drawer.drawer-peek {
        padding-bottom: 0 !important;
    }
    /* Open state: full drawer */
    #list-drawer.drawer-open {
        transform: translateY(0) !important;
        pointer-events: auto !important;
    }
}

/* Backdrop overlay when drawer is fully open */
#drawer-backdrop {
    position: fixed;
    inset: 0;
    background: transparent;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s cubic-bezier(0.32, 0.72, 0, 1);
    z-index: 899;
}
#drawer-backdrop.active {
    opacity: 1;
    pointer-events: auto;
    z-index: 899; /* Below drawer (900) so drawer receives touch events */
}

/* iOS rubber-banding fix + dynamic viewport height */
#list-content {
    overscroll-behavior: contain;
    overflow-x: hidden;
    overflow-y: auto;
    flex: 1;
    min-height: 0;
    -webkit-overflow-scrolling: touch; /* Smooth scroll on iOS */
}
/* Mobile: add bottom padding so last items scroll fully into view */
@media (max-width: 767px) {
    #list-content {
        padding-bottom: 80px;
    }
    /* When banner is visible, reduce bottom padding */
    #list-drawer:has(.drawer-bottom-banner.show) #list-content {
        padding-bottom: 12px;
    }
}

/* Desktop: overflow visible for dropdown menus etc */
@media (min-width: 768px) {
    #list-drawer {
        overflow: visible !important;
    }
}
/* Mobile: overflow hidden so child list can scroll */
@media (max-width: 767px) {
    #list-drawer {
        overflow: hidden !important;
    }
}
@media (min-width: 768px) {
    #list-content {
        max-height: calc(100vh - 180px);
        height: auto; /* Override mobile height: 0 */
    }
}

/* Safe area insets for iPhone X+ */
.glass-panel.rounded-full { padding-top: max(0.375rem, env(safe-area-inset-top)); }
#list-drawer { padding-bottom: env(safe-area-inset-bottom); }

/* --- DRAG HANDLE --- */
.drag-handle {
    /* 48px minimum touch target (WCAG AAA compliant) */
    min-width: 48px;
    min-height: 48px;
    cursor: pointer;
}

.drag-handle:active span {
    background-color: rgba(255, 255, 255, 0.6);
}

/* Move drag handle up in plan mode to avoid overlap */
body.plan-mode .drag-handle {
    top: -8px;
}

/* --- DRAWER BOTTOM BANNER --- */
.drawer-bottom-banner {
    display: none; /* Hidden by default, shown via JS */
    position: sticky;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 50;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.95) 70%, rgba(0, 0, 0, 0.85));
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    padding: 12px 16px;
    padding-bottom: max(12px, env(safe-area-inset-bottom));
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
}

.drawer-bottom-banner.show {
    display: flex;
}

.drawer-bottom-banner .banner-text {
    color: rgba(255, 255, 255, 0.7);
    font-size: 14px;
    flex-shrink: 1;
    min-width: 0;
}

.drawer-bottom-banner .banner-text strong {
    color: white;
    font-weight: 600;
}

.drawer-bottom-banner .banner-action-btn {
    background: rgba(255, 255, 255, 0.12);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 8px 14px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
    white-space: nowrap;
    transition: all 0.15s ease;
    cursor: pointer;
    flex-shrink: 0;
}

.drawer-bottom-banner .banner-action-btn:hover {
    background: rgba(255, 255, 255, 0.18);
    border-color: rgba(255, 255, 255, 0.3);
}

.drawer-bottom-banner .banner-action-btn:active {
    transform: scale(0.97);
}

/* Hide banner in peek mode on mobile */
@media (max-width: 767px) {
    #list-drawer.drawer-peek .drawer-bottom-banner {
        display: none !important;
    }
}
