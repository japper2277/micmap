<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MicFinder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: { 900: '#0a0a0a', 800: '#141414', 700: '#1e1e1e', 600: '#2a2a2a' },
                        accent: { DEFAULT: '#ef4444', dark: '#dc2626' }
                    }
                }
            }
        }
    </script>
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }

        .chat-panel {
            position: fixed; bottom: 0; left: 0; right: 0;
            height: 85vh; max-height: 700px;
            background: #141414;
            border-radius: 20px 20px 0 0;
            transform: translateY(100%);
            transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
        }
        .chat-panel.open { transform: translateY(0); }

        .backdrop {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.6);
            opacity: 0; visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .backdrop.show { opacity: 1; visibility: visible; }

        .step-container {
            position: relative;
            overflow: hidden;
        }
        .step {
            opacity: 1;
            transform: translateX(0);
            transition: all 0.3s ease-out;
        }
        .step.exit-left {
            opacity: 0;
            transform: translateX(-30px);
            position: absolute;
            top: 0; left: 0; right: 0;
        }
        .step.exit-right {
            opacity: 0;
            transform: translateX(30px);
            position: absolute;
            top: 0; left: 0; right: 0;
        }
        .step.enter {
            opacity: 0;
            transform: translateX(30px);
        }
        .step.enter-back {
            opacity: 0;
            transform: translateX(-30px);
        }

        .venue-card {
            background: linear-gradient(135deg, #1e1e1e 0%, #252525 100%);
            border: 1px solid #333;
            transition: all 0.2s;
        }
        .venue-card:active { transform: scale(0.98); background: #2a2a2a; }

        .quick-btn {
            background: #1e1e1e; border: 1px solid #333;
            transition: all 0.15s;
        }
        .quick-btn:hover { background: #2a2a2a; border-color: #444; }
        .quick-btn:active { transform: scale(0.96); }

        .fab {
            width: 60px; height: 60px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.4);
            transition: all 0.2s;
        }
        .fab:hover { transform: scale(1.05); }
        .fab:active { transform: scale(0.95); }

        .filter-chip {
            background: #1e1e1e;
            border: 1px solid #333;
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 13px;
            color: #ccc;
            transition: all 0.15s;
            cursor: pointer;
        }
        .filter-chip:hover { border-color: #555; background: #252525; }
        .filter-chip:active { transform: scale(0.95); }
        .filter-chip.active {
            background: #ef4444;
            border-color: #ef4444;
            color: white;
        }

        .filter-section {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
        }
        .filter-section.open {
            max-height: 400px;
            padding-top: 12px;
            padding-bottom: 12px;
        }

        .back-btn {
            transition: all 0.15s;
        }
        .back-btn:hover { background: rgba(255,255,255,0.1); }
        .back-btn:active { transform: scale(0.95); }

        .content-area {
            overflow-y: auto;
        }
        .content-area::-webkit-scrollbar { width: 4px; }
        .content-area::-webkit-scrollbar-track { background: transparent; }
        .content-area::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        .status-live { background: #22c55e; box-shadow: 0 0 6px #22c55e; }
        .status-upcoming { background: #eab308; }
        .status-future { background: #6b7280; }

        .refine-btn {
            transition: all 0.15s;
        }
        .refine-btn:active { transform: scale(0.95); }

        .time-picker {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, margin 0.3s ease-out;
            margin-top: 0;
        }
        .time-picker.open {
            max-height: 200px;
            margin-top: 8px;
        }
        .time-pick-btn:hover { background: #2a2a2a; border-color: #555; }
        .time-pick-btn:active { transform: scale(0.95); }
    </style>
</head>
<body class="bg-dark-900 text-white min-h-screen">

    <!-- Fake Map Background -->
    <div class="fixed inset-0 bg-dark-900 flex items-center justify-center">
        <div class="text-center text-gray-600">
            <i class="fas fa-map text-6xl mb-4"></i>
            <p>Map View</p>
            <p class="text-sm text-gray-700 mt-2">Tap the chat button to try the assistant</p>
        </div>
    </div>

    <!-- FAB -->
    <button id="fab" class="fab fixed bottom-6 right-6 rounded-full flex items-center justify-center z-40" onclick="toggleChat()">
        <i class="fas fa-comment-dots text-2xl"></i>
    </button>

    <!-- Backdrop -->
    <div id="backdrop" class="backdrop z-40" onclick="toggleChat()"></div>

    <!-- Chat Panel -->
    <div id="chatPanel" class="chat-panel z-50 flex flex-col">
        <div class="flex justify-center pt-3 pb-2" onclick="toggleChat()">
            <div class="w-10 h-1 bg-gray-600 rounded-full"></div>
        </div>

        <!-- Header -->
        <div class="px-4 pb-3 flex items-center justify-between border-b border-gray-800">
            <div class="flex items-center gap-2">
                <button id="backBtn" onclick="goBack()" class="back-btn w-8 h-8 rounded-full flex items-center justify-center text-gray-400 hidden">
                    <i class="fas fa-arrow-left text-sm"></i>
                </button>
                <div class="flex items-center gap-3">
                    <div class="w-9 h-9 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-microphone text-sm"></i>
                    </div>
                    <div>
                        <div class="font-semibold text-sm">MicFinder</div>
                        <div class="text-xs text-gray-500" id="headerSubtitle">Find your stage</div>
                    </div>
                </div>
            </div>
            <button onclick="goHome()" class="text-gray-500 hover:text-white p-2">
                <i class="fas fa-home text-sm"></i>
            </button>
        </div>

        <!-- Content area -->
        <div id="stepContainer" class="flex-1 step-container">
            <div id="currentStep" class="step p-4 content-area h-full"></div>
        </div>
    </div>

    <script>
        const DAYS = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const TODAY = new Date().getDay();
        const TODAY_NAME = DAYS[TODAY];
        const TOMORROW_NAME = DAYS[(TODAY + 1) % 7];

        const MICS = [
            { id: 1, venue: "The Stand", time: "7:00 PM", borough: "Manhattan", hood: "Gramercy", price: "Free", status: "live", day: TODAY_NAME, distance: 12 },
            { id: 2, venue: "Creek & Cave", time: "7:30 PM", borough: "Queens", hood: "LIC", price: "Free", status: "upcoming", day: TODAY_NAME, distance: 28 },
            { id: 3, venue: "Comedy Cellar", time: "8:00 PM", borough: "Manhattan", hood: "West Village", price: "$5", status: "upcoming", day: TODAY_NAME, distance: 18 },
            { id: 4, venue: "Eastville Comedy", time: "8:30 PM", borough: "Brooklyn", hood: "Boerum Hill", price: "Free", status: "future", day: TODAY_NAME, distance: 8 },
            { id: 5, venue: "The Lantern", time: "9:00 PM", borough: "Brooklyn", hood: "Williamsburg", price: "Free", status: "future", day: TODAY_NAME, distance: 15 },
            { id: 6, venue: "QED Astoria", time: "9:30 PM", borough: "Queens", hood: "Astoria", price: "$3", status: "future", day: TODAY_NAME, distance: 35 },
            { id: 7, venue: "Stand Up NY", time: "10:00 PM", borough: "Manhattan", hood: "UWS", price: "Free", status: "future", day: TODAY_NAME, distance: 30 },
            { id: 8, venue: "Tiny Cupboard", time: "10:30 PM", borough: "Brooklyn", hood: "Bushwick", price: "Free", status: "future", day: TOMORROW_NAME, distance: 20 },
            { id: 9, venue: "The Grisly Pear", time: "6:00 PM", borough: "Manhattan", hood: "West Village", price: "Free", status: "future", day: TOMORROW_NAME, distance: 17 },
            { id: 10, venue: "Carolines", time: "7:00 PM", borough: "Manhattan", hood: "Times Square", price: "$10", status: "future", day: TOMORROW_NAME, distance: 25 },
            { id: 11, venue: "The Pit", time: "8:00 PM", borough: "Manhattan", hood: "Midtown", price: "$5", status: "future", day: 'Saturday', distance: 22 },
            { id: 12, venue: "Union Hall", time: "8:30 PM", borough: "Brooklyn", hood: "Park Slope", price: "Free", status: "future", day: 'Saturday', distance: 14 },
            { id: 13, venue: "Knitting Factory", time: "9:00 PM", borough: "Brooklyn", hood: "Williamsburg", price: "Free", status: "future", day: 'Sunday', distance: 16 },
        ];

        let isOpen = false;
        let currentView = 'home';
        let filters = {
            when: null,           // 'all', 'weekend', or null (uses selectedDays)
            selectedDays: [],     // Array of day names for multi-select
            where: null,          // 'Manhattan', 'Brooklyn', etc
            price: null,          // 'free', 'paid', null
            time: null,           // 'afternoon', 'evening', 'latenight', 'custom'
            customTime: null,     // Hour number (12-11 for pm hours)
            showTimePicker: false,
            nearbyOnly: false
        };
        let filtersExpanded = false;

        function toggleChat() {
            isOpen = !isOpen;
            document.getElementById('chatPanel').classList.toggle('open', isOpen);
            document.getElementById('backdrop').classList.toggle('show', isOpen);
            document.getElementById('fab').innerHTML = isOpen
                ? '<i class="fas fa-times text-2xl"></i>'
                : '<i class="fas fa-comment-dots text-2xl"></i>';

            if (isOpen && currentView === 'home') {
                renderHome();
            }
        }

        function goHome() {
            currentView = 'home';
            filters = {
                when: null,
                selectedDays: [],
                where: null,
                price: null,
                time: null,
                customTime: null,
                showTimePicker: false,
                nearbyOnly: false
            };
            filtersExpanded = false;
            transitionStep(renderHomeContent, 'back');
            document.getElementById('backBtn').classList.add('hidden');
            document.getElementById('headerSubtitle').textContent = 'Find your stage';
        }

        function goBack() {
            goHome();
        }

        function transitionStep(renderFn, direction = 'forward') {
            const container = document.getElementById('stepContainer');
            const currentStep = document.getElementById('currentStep');

            const newStep = document.createElement('div');
            newStep.id = 'currentStep';
            newStep.className = `step p-4 content-area h-full ${direction === 'forward' ? 'enter' : 'enter-back'}`;

            renderFn(newStep);

            currentStep.classList.add(direction === 'forward' ? 'exit-left' : 'exit-right');
            container.appendChild(newStep);

            requestAnimationFrame(() => {
                newStep.classList.remove('enter', 'enter-back');
            });

            setTimeout(() => {
                currentStep.remove();
            }, 300);
        }

        function renderHome() {
            const step = document.getElementById('currentStep');
            renderHomeContent(step);
        }

        function renderHomeContent(container) {
            container.innerHTML = `
                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-1">What are you looking for?</h2>
                    <p class="text-gray-500 text-sm">Tap to see results instantly</p>
                </div>

                <div class="space-y-3">
                    <button onclick="quickAction('tonight-near')" class="quick-btn w-full p-4 rounded-2xl flex items-center gap-4 text-left">
                        <div class="w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center">
                            <i class="fas fa-location-dot text-green-400 text-lg"></i>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium">Tonight near me</div>
                            <div class="text-sm text-gray-500">Mics closest to you</div>
                        </div>
                        <i class="fas fa-chevron-right text-gray-600"></i>
                    </button>

                    <button onclick="quickAction('tonight')" class="quick-btn w-full p-4 rounded-2xl flex items-center gap-4 text-left">
                        <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                            <i class="fas fa-moon text-blue-400 text-lg"></i>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium">All mics tonight</div>
                            <div class="text-sm text-gray-500">${countMics('today')} mics happening today</div>
                        </div>
                        <i class="fas fa-chevron-right text-gray-600"></i>
                    </button>

                    <button onclick="quickAction('weekend')" class="quick-btn w-full p-4 rounded-2xl flex items-center gap-4 text-left">
                        <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center">
                            <i class="fas fa-calendar-week text-purple-400 text-lg"></i>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium">This weekend</div>
                            <div class="text-sm text-gray-500">Saturday & Sunday mics</div>
                        </div>
                        <i class="fas fa-chevron-right text-gray-600"></i>
                    </button>

                    <button onclick="quickAction('free')" class="quick-btn w-full p-4 rounded-2xl flex items-center gap-4 text-left">
                        <div class="w-12 h-12 bg-yellow-500/20 rounded-xl flex items-center justify-center">
                            <i class="fas fa-ticket text-yellow-400 text-lg"></i>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium">Free mics today</div>
                            <div class="text-sm text-gray-500">${countMics('free')} free mics</div>
                        </div>
                        <i class="fas fa-chevron-right text-gray-600"></i>
                    </button>

                    <button onclick="quickAction('browse')" class="quick-btn w-full p-4 rounded-2xl flex items-center gap-4 text-left">
                        <div class="w-12 h-12 bg-gray-500/20 rounded-xl flex items-center justify-center">
                            <i class="fas fa-search text-gray-400 text-lg"></i>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium">Browse & filter</div>
                            <div class="text-sm text-gray-500">Custom search</div>
                        </div>
                        <i class="fas fa-chevron-right text-gray-600"></i>
                    </button>
                </div>
            `;
        }

        function countMics(type) {
            if (type === 'today') return MICS.filter(m => m.day === TODAY_NAME).length;
            if (type === 'free') return MICS.filter(m => m.day === TODAY_NAME && m.price === 'Free').length;
            return MICS.length;
        }

        function quickAction(action) {
            currentView = 'results';
            filtersExpanded = false;

            if (action === 'tonight-near') {
                filters.selectedDays = [TODAY_NAME];
                filters.nearbyOnly = true;
                document.getElementById('headerSubtitle').textContent = 'Tonight near you';
            } else if (action === 'tonight') {
                filters.selectedDays = [TODAY_NAME];
                document.getElementById('headerSubtitle').textContent = 'Tonight';
            } else if (action === 'weekend') {
                filters.when = 'weekend';
                filters.selectedDays = ['Saturday', 'Sunday'];
                document.getElementById('headerSubtitle').textContent = 'This weekend';
            } else if (action === 'free') {
                filters.selectedDays = [TODAY_NAME];
                filters.price = 'free';
                document.getElementById('headerSubtitle').textContent = 'Free mics today';
            } else if (action === 'browse') {
                filters.selectedDays = [TODAY_NAME];
                filtersExpanded = true;
                document.getElementById('headerSubtitle').textContent = 'Browse';
            }

            document.getElementById('backBtn').classList.remove('hidden');
            transitionStep(renderResults, 'forward');
        }

        function getFilteredMics() {
            let results = [...MICS];

            // When filter - use selectedDays array
            if (filters.selectedDays && filters.selectedDays.length > 0) {
                results = results.filter(m => filters.selectedDays.includes(m.day));
            }

            // Where filter
            if (filters.where && filters.where !== 'nearby') {
                results = results.filter(m => m.borough === filters.where);
            }

            // Price filter
            if (filters.price === 'free') {
                results = results.filter(m => m.price === 'Free');
            } else if (filters.price === 'paid') {
                results = results.filter(m => m.price !== 'Free');
            }

            // Time filter
            const getMicHour = (m) => {
                const hour = parseInt(m.time);
                const isPM = m.time.includes('PM');
                return isPM && hour !== 12 ? hour + 12 : (hour === 12 && isPM ? 12 : hour);
            };

            if (filters.time === 'afternoon') {
                results = results.filter(m => {
                    const h24 = getMicHour(m);
                    return h24 >= 12 && h24 < 17;
                });
            } else if (filters.time === 'evening') {
                results = results.filter(m => {
                    const h24 = getMicHour(m);
                    return h24 >= 17 && h24 < 21;
                });
            } else if (filters.time === 'latenight') {
                results = results.filter(m => {
                    const h24 = getMicHour(m);
                    return h24 >= 21;
                });
            } else if (filters.time === 'custom' && filters.customTime) {
                // Custom time: show mics at or after the selected hour
                const filterHour = filters.customTime < 12 ? filters.customTime + 12 : filters.customTime;
                results = results.filter(m => {
                    const h24 = getMicHour(m);
                    return h24 >= filterHour;
                });
            }

            // Sort by distance if nearby
            if (filters.nearbyOnly) {
                results.sort((a, b) => a.distance - b.distance);
            } else {
                // Sort by time
                results.sort((a, b) => {
                    const getMinutes = (t) => {
                        const hour = parseInt(t);
                        const isPM = t.includes('PM');
                        return (isPM && hour !== 12 ? hour + 12 : hour) * 60;
                    };
                    return getMinutes(a.time) - getMinutes(b.time);
                });
            }

            return results;
        }

        function toggleFilters() {
            filtersExpanded = !filtersExpanded;
            const section = document.getElementById('filterSection');
            const icon = document.getElementById('refineIcon');
            section.classList.toggle('open', filtersExpanded);
            icon.style.transform = filtersExpanded ? 'rotate(180deg)' : '';
        }

        function setFilter(type, value) {
            if (filters[type] === value) {
                filters[type] = null;
            } else {
                filters[type] = value;
            }
            // Clear custom time if switching to preset
            if (type === 'time' && value !== 'custom') {
                filters.customTime = null;
                filters.showTimePicker = false;
            }
            updateResults();
        }

        function setWhenFilter(value) {
            if (filters.when === value) {
                filters.when = null;
                filters.selectedDays = [];
            } else {
                filters.when = value;
                if (value === 'all') {
                    filters.selectedDays = [...DAYS];
                } else if (value === 'weekend') {
                    filters.selectedDays = ['Saturday', 'Sunday'];
                }
            }
            updateResults();
        }

        function toggleDay(day) {
            filters.when = null; // Clear presets
            const idx = filters.selectedDays.indexOf(day);
            if (idx > -1) {
                filters.selectedDays.splice(idx, 1);
            } else {
                filters.selectedDays.push(day);
            }
            updateResults();
        }

        function toggleTimePicker() {
            filters.showTimePicker = !filters.showTimePicker;
            if (filters.showTimePicker) {
                filters.time = 'custom';
            }
            updateResults();
        }

        function setCustomTime(hour) {
            filters.customTime = hour;
            filters.time = 'custom';
            filters.showTimePicker = false;
            updateResults();
        }

        function formatTime(hour) {
            return hour === 12 ? '12pm' : hour + 'pm';
        }

        function updateResults() {
            // Re-render the entire results view to update filter chip states
            const container = document.getElementById('currentStep');
            renderResults(container);

            // Restore filter section state
            if (filtersExpanded) {
                const section = document.getElementById('filterSection');
                const icon = document.getElementById('refineIcon');
                if (section) section.classList.add('open');
                if (icon) icon.style.transform = 'rotate(180deg)';
            }
        }

        function clearFilters() {
            filters.when = null;
            filters.selectedDays = [];
            filters.where = null;
            filters.price = null;
            filters.time = null;
            filters.customTime = null;
            filters.showTimePicker = false;
            updateResults();
        }

        function renderMicCard(mic) {
            const statusClass = mic.status === 'live' ? 'status-live' : mic.status === 'upcoming' ? 'status-upcoming' : 'status-future';
            const statusLabel = mic.status === 'live' ? 'Live now' : mic.status === 'upcoming' ? 'Starting soon' : '';

            return `
                <div class="venue-card rounded-2xl p-4 cursor-pointer" onclick="showVenue(${mic.id})">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <div class="font-semibold">${mic.venue}</div>
                            <div class="text-sm text-gray-400">${mic.hood}, ${mic.borough}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-medium">${mic.time}</div>
                            <div class="text-sm ${mic.price === 'Free' ? 'text-green-400' : 'text-gray-400'}">${mic.price}</div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            ${statusLabel ? `<span class="status-dot ${statusClass}"></span><span class="text-xs text-gray-400">${statusLabel}</span>` : ''}
                        </div>
                        ${filters.nearbyOnly ? `<span class="text-xs text-gray-500">${mic.distance} min</span>` : ''}
                    </div>
                </div>
            `;
        }

        function renderResults(container) {
            const results = getFilteredMics();

            container.innerHTML = `
                <!-- Header bar with count and refine -->
                <div class="flex items-center justify-between mb-3">
                    <span id="resultCount" class="text-gray-400 text-sm">${results.length} mics</span>
                    <button onclick="toggleFilters()" class="refine-btn flex items-center gap-2 text-sm text-gray-400 hover:text-white px-3 py-1.5 rounded-lg bg-dark-700">
                        <i class="fas fa-sliders text-xs"></i>
                        <span>Refine</span>
                        <i id="refineIcon" class="fas fa-chevron-down text-xs transition-transform"></i>
                    </button>
                </div>

                <!-- Expandable filter section -->
                <div id="filterSection" class="filter-section border-b border-gray-800 -mx-4 px-4 ${filtersExpanded ? 'open' : ''}">
                    <!-- When -->
                    <div class="mb-3">
                        <div class="text-xs text-gray-500 mb-2">WHEN</div>
                        <div class="flex flex-wrap gap-2 mb-2">
                            <button class="filter-chip ${filters.when === 'all' ? 'active' : ''}" onclick="setWhenFilter('all')">All week</button>
                            <button class="filter-chip ${filters.when === 'weekend' ? 'active' : ''}" onclick="setWhenFilter('weekend')">Weekend</button>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            ${DAYS.map(day => {
                                const isSelected = Array.isArray(filters.selectedDays) && filters.selectedDays.includes(day);
                                const shortDay = day.slice(0, 3);
                                const isToday = day === TODAY_NAME;
                                const isTomorrow = day === TOMORROW_NAME;
                                const label = isToday ? 'Today' : isTomorrow ? 'Tmrw' : shortDay;
                                return `<button class="filter-chip ${isSelected ? 'active' : ''}" onclick="toggleDay('${day}')">${label}</button>`;
                            }).join('')}
                        </div>
                    </div>

                    <!-- Where -->
                    <div class="mb-3">
                        <div class="text-xs text-gray-500 mb-2">WHERE</div>
                        <div class="flex flex-wrap gap-2">
                            <button class="filter-chip ${filters.where === 'Manhattan' ? 'active' : ''}" onclick="setFilter('where', 'Manhattan')">Manhattan</button>
                            <button class="filter-chip ${filters.where === 'Brooklyn' ? 'active' : ''}" onclick="setFilter('where', 'Brooklyn')">Brooklyn</button>
                            <button class="filter-chip ${filters.where === 'Queens' ? 'active' : ''}" onclick="setFilter('where', 'Queens')">Queens</button>
                            <button class="filter-chip ${filters.where === 'Bronx' ? 'active' : ''}" onclick="setFilter('where', 'Bronx')">Bronx</button>
                        </div>
                    </div>

                    <!-- Time -->
                    <div class="mb-3">
                        <div class="text-xs text-gray-500 mb-2">TIME</div>
                        <div class="flex flex-wrap gap-2 mb-2">
                            <button class="filter-chip ${filters.time === 'afternoon' ? 'active' : ''}" onclick="setFilter('time', 'afternoon')">Afternoon</button>
                            <button class="filter-chip ${filters.time === 'evening' ? 'active' : ''}" onclick="setFilter('time', 'evening')">Evening</button>
                            <button class="filter-chip ${filters.time === 'latenight' ? 'active' : ''}" onclick="setFilter('time', 'latenight')">Late night</button>
                            <button class="filter-chip ${filters.time === 'custom' ? 'active' : ''}" onclick="toggleTimePicker()">
                                ${filters.customTime ? formatTime(filters.customTime) + '+' : 'Pick time'}
                            </button>
                        </div>
                        <div id="timePicker" class="time-picker ${filters.showTimePicker ? 'open' : ''}">
                            <div class="grid grid-cols-4 gap-2">
                                ${[12,1,2,3,4,5,6,7,8,9,10,11].map(h => {
                                    const hour = h === 12 ? 12 : h;
                                    const isPM = h >= 12 || h < 6;
                                    const display = h + (h < 12 ? 'pm' : 'pm');
                                    const displayHour = h > 12 ? h - 12 : h;
                                    const label = displayHour + (h >= 12 || h === 12 ? 'pm' : 'pm');
                                    const actualLabel = h + 'pm';
                                    const isSelected = filters.customTime === h;
                                    return `<button class="time-pick-btn px-3 py-2 rounded-lg text-sm border border-gray-700 ${isSelected ? 'bg-red-500 border-red-500' : 'bg-dark-800'}" onclick="setCustomTime(${h})">${h === 12 ? '12pm' : h + 'pm'}</button>`;
                                }).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- Price -->
                    <div>
                        <div class="text-xs text-gray-500 mb-2">PRICE</div>
                        <div class="flex flex-wrap gap-2">
                            <button class="filter-chip ${filters.price === 'free' ? 'active' : ''}" onclick="setFilter('price', 'free')">Free</button>
                            <button class="filter-chip ${filters.price === 'paid' ? 'active' : ''}" onclick="setFilter('price', 'paid')">Paid</button>
                        </div>
                    </div>
                </div>

                <!-- Results list -->
                <div id="micList" class="space-y-3 mt-4">
                    ${results.length === 0 ? `
                        <div class="text-center py-12 text-gray-500">
                            <i class="fas fa-search text-4xl mb-3 opacity-50"></i>
                            <p>No mics match your filters</p>
                        </div>
                    ` : results.map(mic => renderMicCard(mic)).join('')}
                </div>
            `;

            // Auto-expand if browse mode
            if (filtersExpanded) {
                setTimeout(() => {
                    const section = document.getElementById('filterSection');
                    const icon = document.getElementById('refineIcon');
                    if (section) section.classList.add('open');
                    if (icon) icon.style.transform = 'rotate(180deg)';
                }, 50);
            }
        }

        function showVenue(id) {
            const mic = MICS.find(m => m.id === id);
            if (!mic) return;

            transitionStep((container) => {
                container.innerHTML = `
                    <div class="venue-card rounded-2xl p-5 mb-4">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h2 class="text-xl font-semibold">${mic.venue}</h2>
                                <p class="text-gray-400">${mic.hood}, ${mic.borough}</p>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold">${mic.time}</div>
                                <div class="${mic.price === 'Free' ? 'text-green-400' : 'text-gray-400'}">${mic.price}</div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <div class="bg-dark-800 rounded-xl p-3 text-center">
                                <div class="text-2xl font-bold">${mic.distance}</div>
                                <div class="text-xs text-gray-500">min away</div>
                            </div>
                            <div class="bg-dark-800 rounded-xl p-3 text-center">
                                <div class="text-2xl font-bold">${mic.day.slice(0,3)}</div>
                                <div class="text-xs text-gray-500">${mic.day === TODAY_NAME ? 'Today' : mic.day === TOMORROW_NAME ? 'Tomorrow' : mic.day}</div>
                            </div>
                        </div>

                        <div class="space-y-2 text-sm text-gray-400 mb-4">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-clock w-4 text-center"></i>
                                <span>Signup starts at ${mic.time}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-users w-4 text-center"></i>
                                <span>Usually 15-20 comics</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-microphone w-4 text-center"></i>
                                <span>5 minute sets</span>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <button class="w-full py-3 bg-red-500 hover:bg-red-600 rounded-xl font-medium transition">
                            <i class="fas fa-map-marker-alt mr-2"></i>
                            Show on map
                        </button>
                        <button class="w-full py-3 bg-dark-700 hover:bg-dark-600 rounded-xl font-medium transition border border-gray-700">
                            <i class="fas fa-directions mr-2"></i>
                            Get directions
                        </button>
                    </div>
                `;
            }, 'forward');

            document.getElementById('headerSubtitle').textContent = mic.venue;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderHome();
        });
    </script>
</body>
</html>
